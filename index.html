<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,
            maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="http://api.maps.nokia.com/mobile/0.2.0/lib/mh5.css">
    <link rel="stylesheet" href="http://api.maps.nokia.com/mobile/0.2.0/lib/colors.css">
</head>
<body>
Where is <div id="name"></div>
<div id="mapContainer" style="height: 480px; width: 640px;"></div>
<div id="score"></div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.2.min.js"><\/script>')</script>

<script src="http://api.maps.nokia.com/2.2.3/jsl.js" type="text/javascript" charset="utf-8"></script>
<script>
if (typeof Number.prototype.toRad == 'undefined') {
  Number.prototype.toRad = function() {
    return this * Math.PI / 180;
  }
}

    var mapCenter = {
            longitude: 13.3896145,
            latitude: 52.5166648
        };

  var items = [];

  var currentItem;

    $.getJSON('http://demo.places.nlp.nokia.com/places/v1/discover/explore?at='+mapCenter.latitude+'%2C'+mapCenter.longitude+'&tf=plain&pretty=y&size=50&app_id=demo_qCG24t50dHOwrLQ&app_code=NYKC67ShPhQwqaydGIW4yg', function(data) {

  $.each(data.results.items, function(index, val) {
    if (val.type == "urn:nlp-types:place")
    items.push(val);
  });

    currentItem = items[0];

   $("#name").html(currentItem.title);

});



nokia.Settings.set( "appId", "_peU-uCkp-j8ovkzFGNU"); 
nokia.Settings.set( "authenticationToken", "gBoUkAMoxoqIWfxWA5DuMQ");

// Get the DOM node to which we will append the map
var mapContainer = document.getElementById("mapContainer");
// Create a map inside the map container DOM node
var map = new nokia.maps.map.Display(mapContainer, {
	// Initial center and zoom level of the map
	center: [mapCenter.latitude, mapCenter.longitude],
	zoomLevel: 12,
	// We add the behavior component to allow panning / zooming of the map
	components:[]
});


    var handleMapClick = function(coord) {
           var score,lat1,lat2,lon1,lon2;

            lat1 = coord.latitude;
            lon1 = coord.longitude;
            lat2 = currentItem.position[0];
            lon2 = currentItem.position[1];
            
            var R = 6371; // km
            var dLat = (lat2-lat1).toRad();
            var dLon = (lon2-lon1).toRad();
            lat1 = lat1.toRad();
            lat2 = lat2.toRad();



            var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            var d = R * c;

            score = Math.max(Math.round(100 - 70*d), 0);
            
            $("#score").html(score);

            var standardMarker = new nokia.maps.map.StandardMarker(currentItem.position);
            map.objects.add(standardMarker);
            
            currentItem = items[items.indexOf(currentItem) +1];
            $("#name").html(currentItem.title);
            }



var TOUCH = nokia.maps.dom.Page.browser.touch,
	CLICK = TOUCH ? "tap" : "click";

/* Attach an event listener to map display
 * push info bubble with coordinate information to map
 */
map.addListener(CLICK, function (evt) {
	var coord = map.pixelToGeo(evt.displayX, evt.displayY);
	handleMapClick(coord);

});




</script>
</body>
